<!doctype html><html class=h-100 lang=en-us><head><title>ZeroToOne - Practical AWK</title><meta name=description content="Sometimes, we need to run a series of commands or API calls, gather their outputs, and store them in an organized way. For example, imagine we have a â€¦"><meta name=author content="Morteza NourelahiAlamdari"><link rel=icon type=image/x-icon href=/img/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/awesomefont.min.css><link rel=stylesheet href=/css/awesomefont.solid.min.css><meta property="og:image" content="https://0t1.me/img/logo.png"><meta property="og:image:type" content="image/png"><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script></head><body class="fs-5 d-flex flex-column"><header class="container p-2"><a class="navbar-brand text-lowercase" title=Home href=https://0t1.me/>#!/bin/mort</a></header><nav class="navbar navbar-expand-lg navbar-dark shadow"><div class=container><button type=button class="navbar-toggler py-1 px-2" aria-controls=top-navbar data-bs-target=#top-navbar data-bs-toggle=collapse aria-expanded=false aria-label="toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-left" id=top-navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link title=Home href=https://0t1.me/>Home</a></li><li class=nav-item><a class=nav-link title=Blog href=/blog>Blog</a></li><li class=nav-item><a class=nav-link title=Projects href=https://github.com/mortymacs target=_blank>Projects</a></li><li class=nav-item><a class=nav-link title=Dotfiles href=/dotfiles>Dotfiles</a></li><li class=nav-item><a class=nav-link title=Appointment href=https://calendly.com/mortymacs/30min target=_blank>Appointment</a></li><li class=nav-item><a class=nav-link title=Strengths href=/strengths>Strengths</a></li><li class=nav-item><a class=nav-link title=About href=/about>About</a></li></ul></div></div></nav><div class="d-flex flex-column container flex-grow-1 p-3" id=main><div class=flex-grow-1><div class=row><div class="main-content py-2"><div class=mb-3><div class="article-title d-inline"><a href=https://0t1.me/blog/2024/09/01/practical-awk/ class="text-capitalize fw-bold d-inline-block link-underline link-underline-opacity-0">Practical AWK</a></div><div><small class=fst-italic>Sunday, Sep 1, 2024</small></div><div class=article-toc><h4 class=mt-3>Table of Contents</h4><nav id=TableOfContents><ul><li><a href=#what-is-awk>What is AWK</a></li><li><a href=#lets-get-started>Let&rsquo;s get started!</a><ul><li><a href=#prepration>Prepration</a></li><li><a href=#step1-fetch-status>Step1 (Fetch Status)</a></li><li><a href=#step2-fetch-title>Step2 (Fetch Title)</a></li><li><a href=#step3-fetch-content-type>Step3 (Fetch Content-Type)</a></li><li><a href=#step4-find-ip-address>Step4 (Find IP Address)</a></li><li><a href=#step5-find-geo-location>Step5 (Find GEO Location)</a></li><li><a href=#step6-find-phone-code>Step6 (Find Phone Code)</a></li><li><a href=#finalization>Finalization</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div class=article-body><p>Sometimes, we need to run a series of commands or API calls, gather their outputs, and store them in an organized way.
For example, imagine we have a CSV file and want to use multiple cURL commands to fetch information about the data in it.
Then, we might need to clean up and format the results from each step and use them as inputs for other cURL calls or commands.
In this article, I&rsquo;ll show how to handle these real-life scenarios using a powerful tool called AWK.</p><h2 id=what-is-awk>What is AWK</h2><p>Based of <a href=https://en.wikipedia.org/wiki/AWK>Wikipedia</a>:<div class="alert alert-quote border-0 rounded-0 py-3 px-3">AWK is a domain-specific language designed for text processing and typically used as a data extraction and reporting tool.
Like sed and grep, it is a filter, and is a standard feature of most Unix-like operating systems.</div></p><p>Let&rsquo;s say you have a sample file like this:</p><div class="code mb-2"><pre tabindex=0><code>a 10 30
b 2  25
c 15 5
</code></pre></div><p>And you want to filter the output with this query: &ldquo;Get the sum of the second and third columns for all records where the third column is greater than or equal to 10.&rdquo;
You can easily do this with AWK:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>awk <span style=color:#79a8ff>&#39;$3 &gt;= 10 { print $1, $2 + $3}&#39;</span> input.txt
</span></span></code></pre></td></tr></table></div></div></div><p>And the output will be:</p><div class="code mb-2"><pre tabindex=0><code>a 40
b 27
</code></pre></div><h2 id=lets-get-started>Let&rsquo;s get started!</h2><p>In our scenario, we have a CSV file, and we want to go through multiple steps to process the data.</p><p>Sample input CSV file:</p><div class="code mb-2"><i class="title px-2">input.csv</i><hr class="p-0 m-0"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csv data-lang=csv><span style=display:flex><span><span style=color:#79a8ff>Origin</span>
</span></span><span style=display:flex><span><span style=color:#79a8ff>https://www.gnu.org</span>
</span></span><span style=display:flex><span><span style=color:#79a8ff>https://0t1.me</span>
</span></span></code></pre></td></tr></table></div></div></div><p>Sample output CSV file:</p><div class="code mb-2"><i class="title px-2">output.csv</i><hr class="p-0 m-0"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csv data-lang=csv><span style=display:flex><span><span style=color:#79a8ff>Origin</span>,<span style=color:#79a8ff>Status</span>,<span style=color:#79a8ff>Title</span>,<span style=color:#79a8ff>ContentType</span>,<span style=color:#79a8ff>IP</span>,<span style=color:#79a8ff>Country</span>,<span style=color:#79a8ff>City</span>,<span style=color:#79a8ff>PhoneCode</span>
</span></span><span style=display:flex><span><span style=color:#79a8ff>https://gnu.org</span>,<span style=color:#79a8ff>OK</span>,<span style=color:#79a8ff>The GNU Operating System and the Free Software Movement</span>,<span style=color:#79a8ff>text/html</span>,<span style=color:#79a8ff>209.51.188.116</span>,<span style=color:#79a8ff>United States</span>,<span style=color:#79a8ff>Boston</span>,<span style=color:#79a8ff>+1</span>
</span></span><span style=display:flex><span><span style=color:#79a8ff>https://0t1.me</span>,<span style=color:#79a8ff>OK</span>,<span style=color:#79a8ff>ZeroToOne - Home</span>,<span style=color:#79a8ff>text/html</span>,<span style=color:#79a8ff>104.21.84.218</span>,<span style=color:#79a8ff>Canada</span>,<span style=color:#79a8ff>Toronto</span>,<span style=color:#79a8ff>+1</span>
</span></span></code></pre></td></tr></table></div></div></div><p>We need to follow these steps to achieve the output:</p><ol><li>Check the website status by looking at the HTTP code.</li><li>Retrieve the website&rsquo;s title by parsing the <code>&lt;title></code> tag.</li><li>Get the website&rsquo;s content type by reading the <code>Content-Type</code> header.</li><li>Find the website&rsquo;s IP address.</li><li>Use the IP address from step 4 to determine the geo location.</li><li>Use the geo location from step 5 to find the phone code for that area.</li></ol><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>+-------------+     +------------+     +------------------+     +---------------+     +-----------------+     +---------------+
</span></span><span style=display:flex><span>| FetchStatus | --&gt; | FetchTitle | --&gt; | FetchContentType | --&gt; | FindIPAddress | --&gt; | FindGeoLocation | --&gt; | FindPhoneCode |
</span></span><span style=display:flex><span>+-------------+     +------------+     +------------------+     +---------------+     +-----------------+     +---------------+
</span></span></code></pre></td></tr></table></div></div></div><p>To create a final clean code, we should define each step as a separate function.
This makes the code more readable and easier to maintain.</p><h3 id=prepration>Prepration</h3><p>First, we need to create an AWK file with a different delimiter since the input is a CSV file:</p><p>We&rsquo;ll set <code>FS</code> to <code>","</code> to parse based on commas, and <code>OFS</code> to an empty string to ensure the output has no extra spaces around each element.</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div></div><p>Now, we need to ignore the first line as well, since it&rsquo;s the header line:<div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>{
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div></div></p><p>Next, we need a normalizer to clean up our input addresses and prepare them for processing:<div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#b6a0ff>sub</span>(<span style=color:#79a8ff>/www./</span>, <span style=color:#79a8ff>&#34;&#34;</span>, origin) <span style=color:#a8a8a8># remove www from the origin.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#b6a0ff>return</span> origin
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#b6a0ff>print</span> origin
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span></code></pre></div></div></p><p>Also, make sure to grant execute permission to the file:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ chmox u+x ./pipeline.awk
</span></span></code></pre></td></tr></table></div></div></div><p>Now, let&rsquo;s run our code by passing the input file to make sure it works as expected:<div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./pipeline.awk input.csv
</span></span></code></pre></td></tr></table></div></div></div>And the output will be just what we expected, showing only the Origins column:<div class="code mb-2"><pre tabindex=0><code>https://gnu.org
https://0t1.me
</code></pre></div></p><div class="alert alert-info border-0 rounded-0 py-3 px-3"><p>Sometimes, the path to your <code>awk</code> might be different from whatâ€™s mentioned in this article.
To make the script work, you can call the <code>awk</code> command directly:</p><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ awk -f ./pipeline.awk input.csv
</span></span></code></pre></td></tr></table></div></div></div><p>Now, let&rsquo;s get started with the flow.</p><h3 id=step1-fetch-status>Step1 (Fetch Status)</h3><p>Based on the flow, we need to fetch the website&rsquo;s status. To do this, we can use a <code>curl</code> command to get the HTTP code of the website:<div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -s -w <span style=color:#79a8ff>&#39;%{http_code}&#39;</span> URL -o /dev/null
</span></span></code></pre></td></tr></table></div></div></div></p><p>We use <code>-s</code> to make <code>curl</code> silent, and <code>-o</code> to discard the website content.
Without these options, <code>curl</code> would print the entire content, which could interfere with our other processing logic.</p><p>Now, let&rsquo;s implement this inside the AWK file:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s -w &#39;%{http_code}&#39; -L &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39; -o /dev/null&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> status_code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#b6a0ff>if</span> (status_code <span style=color:#00d3d0>==</span> <span style=color:#79a8ff>&#34;200&#34;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#b6a0ff>return</span> <span style=color:#79a8ff>&#34;OK&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#b6a0ff>return</span> <span style=color:#79a8ff>&#34;ERR&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>}
</span></span></code></pre></div></div><div class="alert alert-important border-0 rounded-0 py-3 px-3">Donâ€™t forget to include <code>","</code> (comma) between variables in the <code>print</code> statement, as we want the output in CSV format!</div><p>Let&rsquo;s run it to see the results:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./pipeline.awk input.csv
</span></span><span style=display:flex><span>https://gnu.org,OK
</span></span><span style=display:flex><span>https://0t1.me,OK
</span></span></code></pre></td></tr></table></div></div></div><p>Great! Now let&rsquo;s move on to the next step: fetching the title of the website.</p><h3 id=step2-fetch-title>Step2 (Fetch Title)</h3><p>To complete this step, we need a tool to process HTML content. Here, we use <a href=https://github.com/mgdm/htmlq>htmlq</a> for that purpose.</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s URL | htmlq title -t
</span></span></code></pre></td></tr></table></div></div></div><p>Now, let&rsquo;s add this inside the AWK file:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#b6a0ff>function</span> fetch_website_title(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s -L &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39; | htmlq title -t&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> title) <span style=color:#00d3d0>&gt;</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        <span style=color:#b6a0ff>gsub</span>(<span style=color:#79a8ff>/,/</span>, <span style=color:#79a8ff>&#34; &#34;</span>, title)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    } <span style=color:#b6a0ff>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        title <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;couldn&#39;t fetch it&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#b6a0ff>return</span> title
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    title <span style=color:#00d3d0>=</span> fetch_website_title(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status, <span style=color:#79a8ff>&#34;,&#34;</span>, title
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>}
</span></span></code></pre></div></div><p>To parse various types of website content, you&rsquo;ll need different tools.
For more information about these tools, check out my other post: <a href=https://0t1.me/blog/2023/10/21/handy-cli-utilities-part-1/#jq-xq-yq-htmlq-jless-fq>Handy Command-Line Utilities - Part 1</a>.</p><h3 id=step3-fetch-content-type>Step3 (Fetch Content-Type)</h3><p>Now, let&rsquo;s fetch the website&rsquo;s <code>Content-Type</code> value using <code>curl</code>, <code>grep</code> and <code>cut</code>:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s -L -I URL | grep -i <span style=color:#79a8ff>&#39;^Content-Type: &#39;</span> | cut -d<span style=color:#79a8ff>&#39; &#39;</span> -f2
</span></span></code></pre></td></tr></table></div></div></div><p>We use the <code>-I</code> flag to fetch only the headers.</p><p>Inside the AWK file:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#b6a0ff>function</span> fetch_website_title(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#b6a0ff>function</span> fetch_website_content_type(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s -L -I &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39; | grep -i &#39;^Content-Type: &#39; | cut -d&#39; &#39; -f2&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> content_type) <span style=color:#00d3d0>&gt;</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#b6a0ff>sub</span>(<span style=color:#79a8ff>/;/</span>, <span style=color:#79a8ff>&#34;&#34;</span>, content_type)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#b6a0ff>return</span> content_type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    title <span style=color:#00d3d0>=</span> fetch_website_title(origin)
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    content_type <span style=color:#00d3d0>=</span> fetch_website_content_type(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status, <span style=color:#79a8ff>&#34;,&#34;</span>, title, <span style=color:#79a8ff>&#34;,&#34;</span>, content_type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>}
</span></span></code></pre></div></div><h3 id=step4-find-ip-address>Step4 (Find IP Address)</h3><p>Now, it&rsquo;s time to find the IP address of the website. There are several options for this, but Iâ€™ve chosen the <code>dig</code> command.<div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dig +short HOST
</span></span></code></pre></td></tr></table></div></div></div></p><p>Since the <code>dig</code> command requires the HOST, not the full website address, we need to remove the <code>http</code> and <code>https</code> prefixes.
AWK has the <code>sub</code> function for finding and replacing strings based on regex. Letâ€™s use it to implement our function:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#b6a0ff>function</span> fetch_website_title(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#b6a0ff>function</span> fetch_website_content_type(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#b6a0ff>function</span> find_website_ip(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#b6a0ff>sub</span>(<span style=color:#79a8ff>/http(s)?:\/\//</span>, <span style=color:#79a8ff>&#34;&#34;</span>, origin) <span style=color:#a8a8a8># remove Origin&#39;s prefix</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;dig +short &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> ip) <span style=color:#00d3d0>==</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        ip <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;-&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#b6a0ff>return</span> ip
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    title <span style=color:#00d3d0>=</span> fetch_website_title(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    content_type <span style=color:#00d3d0>=</span> fetch_website_content_type(origin)
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    ip <span style=color:#00d3d0>=</span> find_website_ip(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status, <span style=color:#79a8ff>&#34;,&#34;</span>, title, <span style=color:#79a8ff>&#34;,&#34;</span>, content_type, <span style=color:#79a8ff>&#34;,&#34;</span>, ip
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>}
</span></span></code></pre></div></div><p>Letâ€™s run it to see the results:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ awk -f ./pipeline.awk input.csv
</span></span><span style=display:flex><span>https://gnu.org,OK,The GNU Operating System and the Free Software Movement,text/html,209.51.188.116
</span></span><span style=display:flex><span>https://0t1.me,OK,ZeroToOne - Home,text/html,188.114.97.0
</span></span></code></pre></td></tr></table></div></div></div><p>Awesome! Weâ€™ve got some results now!</p><p>Letâ€™s move on to the next step: finding the location of the IP address we obtained with the <code>dig</code> command.</p><h3 id=step5-find-geo-location>Step5 (Find GEO Location)</h3><p>Here, Iâ€™ll use the ip-api service: <code>http://ip-api.com/json/{IP}</code>.</p><p>The output of this URL is in JSON format. So, we can use the <a href=https://github.com/jqlang/jq><code>jq</code></a> command to parse it:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s http://ip-api.com/json/<span style=color:#00d3d0>{</span>IP<span style=color:#00d3d0>}</span> | jq -r <span style=color:#79a8ff>&#39;.country + &#34;,&#34; + .city&#39;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>Now, let&rsquo;s add this inside the AWK file:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#b6a0ff>function</span> fetch_website_title(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#b6a0ff>function</span> fetch_website_content_type(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#b6a0ff>function</span> find_website_ip(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#b6a0ff>function</span> find_ip_location(ip) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s http://ip-api.com/json/&#39;&#34;</span> ip <span style=color:#79a8ff>&#34;&#39; | jq -r &#39;.country + \&#34;,\&#34; + .city&#39;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> location) <span style=color:#00d3d0>==</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>        location <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    <span style=color:#b6a0ff>return</span> location
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    title <span style=color:#00d3d0>=</span> fetch_website_title(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    content_type <span style=color:#00d3d0>=</span> fetch_website_content_type(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>    ip <span style=color:#00d3d0>=</span> find_website_ip(origin)
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    location <span style=color:#00d3d0>=</span> find_ip_location(ip)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status, <span style=color:#79a8ff>&#34;,&#34;</span>, title, <span style=color:#79a8ff>&#34;,&#34;</span>, content_type, <span style=color:#79a8ff>&#34;,&#34;</span>, ip, <span style=color:#79a8ff>&#34;,&#34;</span>, location
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>}
</span></span></code></pre></div></div><p>Now, let&rsquo;s see the output:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./pipeline.awk input.csv
</span></span><span style=display:flex><span>https://gnu.org,OK,The GNU Operating System and the Free Software Movement,text/html,209.51.188.116,United States
</span></span><span style=display:flex><span>,Boston
</span></span><span style=display:flex><span>https://0t1.me,OK,ZeroToOne - Home,text/html,188.114.97.0,Canada,Toronto
</span></span></code></pre></td></tr></table></div></div></div><h3 id=step6-find-phone-code>Step6 (Find Phone Code)</h3><p>The last step in the flow is to find the phone code for that location.
Iâ€™ll get this information from the <a href=https://www.countrycode.org/>countrycode.org</a> website by parsing the HTML output:</p><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://www.countrycode.org/<span style=color:#00d3d0>{</span>country<span style=color:#00d3d0>}</span> | htmlq <span style=color:#79a8ff>&#39;h2.text-center&#39;</span> -t
</span></span></code></pre></td></tr></table></div></div><p>Before implementing this logic, we need to parse the location to extract only the country name and convert it to lowercase, as the website requires.
AWK&rsquo;s built-in <code>split</code> and <code>tolower</code> functions can help us achieve this.</p><p>So, let&rsquo;s implement the step:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#b6a0ff>function</span> fetch_website_title(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#b6a0ff>function</span> fetch_website_content_type(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#b6a0ff>function</span> find_website_ip(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#b6a0ff>function</span> find_ip_location(ip) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#b6a0ff>function</span> find_location_phone_code(country) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    <span style=color:#b6a0ff>if</span> (country <span style=color:#00d3d0>==</span> <span style=color:#79a8ff>&#34;United States&#34;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>        country <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;usa&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s &#39;https://www.countrycode.org/&#34;</span> <span style=color:#b6a0ff>tolower</span>(country) <span style=color:#79a8ff>&#34;&#39; | htmlq &#39;h2.text-center&#39; -t&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> phone_code) <span style=color:#00d3d0>==</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        phone_code <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    <span style=color:#b6a0ff>return</span> phone_code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    title <span style=color:#00d3d0>=</span> fetch_website_title(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>    content_type <span style=color:#00d3d0>=</span> fetch_website_content_type(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>    ip <span style=color:#00d3d0>=</span> find_website_ip(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>    location <span style=color:#00d3d0>=</span> find_ip_location(ip)
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>    <span style=color:#b6a0ff>split</span>(location, location_parts, <span style=color:#79a8ff>&#34;,&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>    phone_code <span style=color:#00d3d0>=</span> find_location_phone_code(location_parts[<span style=color:#00bcff>1</span>])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status, <span style=color:#79a8ff>&#34;,&#34;</span>, title, <span style=color:#79a8ff>&#34;,&#34;</span>, content_type, <span style=color:#79a8ff>&#34;,&#34;</span>, ip, <span style=color:#79a8ff>&#34;,&#34;</span>, location, <span style=color:#79a8ff>&#34;,&#34;</span>, phone_code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span>}
</span></span></code></pre></div></div><p>Let&rsquo;s run it:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./pipeline.awk input.csv
</span></span><span style=display:flex><span>https://gnu.org,OK,The GNU Operating System and the Free Software Movement,text/html,209.51.188.116,United States
</span></span><span style=display:flex><span>,Boston,+1
</span></span><span style=display:flex><span>https://0t1.me,OK,ZeroToOne - Home,text/html,188.114.97.0,Canada,Toronto,+1
</span></span></code></pre></td></tr></table></div></div></div><h3 id=finalization>Finalization</h3><p>Now that we have the results we&rsquo;re looking for, the only remaining step is to prepare it for output.</p><p>As we wanted to achieve this output structure:</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csv data-lang=csv><span style=display:flex><span><span style=color:#79a8ff>Origin</span>,<span style=color:#79a8ff>Status</span>,<span style=color:#79a8ff>Title</span>,<span style=color:#79a8ff>ContentType</span>,<span style=color:#79a8ff>IP</span>,<span style=color:#79a8ff>Country</span>,<span style=color:#79a8ff>City</span>,<span style=color:#79a8ff>PhoneCode</span>
</span></span></code></pre></td></tr></table></div></div></div><p>We need to include a header in our output file, so we should add a <code>print</code> statement in the <code>BEGIN</code> section:<div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex;background-color:#191919><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#b6a0ff>print</span> <span style=color:#79a8ff>&#34;Origin,Status,Title,ContentType,IP,Country,City,PhoneCode&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>}
</span></span></code></pre></div></div></p><p>So, all in one place:</p><div class="code mb-2"><i class="title px-2">pipeline.awk</i><hr class="p-0 m-0"><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a8a8a8>#!/usr/bin/awk -f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f78fe7>BEGIN</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f78fe7>FS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;,&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f78fe7>OFS</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#b6a0ff>print</span> <span style=color:#79a8ff>&#34;Origin,Status,Title,ContentType,IP,Country,City,PhoneCode&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#b6a0ff>function</span> normalize_origin(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#b6a0ff>sub</span>(<span style=color:#79a8ff>/www./</span>, <span style=color:#79a8ff>&#34;&#34;</span>, origin) <span style=color:#a8a8a8># remove www from the origin.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#b6a0ff>return</span> origin
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#b6a0ff>function</span> get_website_status(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s -w &#39;%{http_code}&#39; -L &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39; -o /dev/null&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> status_code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#b6a0ff>if</span> (status_code <span style=color:#00d3d0>==</span> <span style=color:#79a8ff>&#34;200&#34;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>        <span style=color:#b6a0ff>return</span> <span style=color:#79a8ff>&#34;OK&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#b6a0ff>return</span> <span style=color:#79a8ff>&#34;ERR&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#b6a0ff>function</span> fetch_website_title(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s -L &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39; | htmlq title -t&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> title) <span style=color:#00d3d0>&gt;</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#b6a0ff>gsub</span>(<span style=color:#79a8ff>/,/</span>, <span style=color:#79a8ff>&#34; &#34;</span>, title)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    } <span style=color:#b6a0ff>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        title <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;couldn&#39;t fetch it&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#b6a0ff>return</span> title
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#b6a0ff>function</span> fetch_website_content_type(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s -L -I &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39; | grep -i &#39;^Content-Type: &#39; | cut -d&#39; &#39; -f2&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> content_type) <span style=color:#00d3d0>&gt;</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>        <span style=color:#b6a0ff>sub</span>(<span style=color:#79a8ff>/;/</span>, <span style=color:#79a8ff>&#34;&#34;</span>, content_type)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    <span style=color:#b6a0ff>return</span> content_type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#b6a0ff>function</span> find_website_ip(origin) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>    <span style=color:#b6a0ff>sub</span>(<span style=color:#79a8ff>/http(s)?:\/\//</span>, <span style=color:#79a8ff>&#34;&#34;</span>, origin) <span style=color:#a8a8a8># remove Origin&#39;s prefix</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;dig +short &#39;&#34;</span> origin <span style=color:#79a8ff>&#34;&#39;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> ip) <span style=color:#00d3d0>==</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>        ip <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;-&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>    <span style=color:#b6a0ff>return</span> ip
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span><span style=color:#b6a0ff>function</span> find_ip_location(ip) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s http://ip-api.com/json/&#39;&#34;</span> ip <span style=color:#79a8ff>&#34;&#39; | jq -r &#39;.country + \&#34;,\&#34; + .city&#39;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> location) <span style=color:#00d3d0>==</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span>        location <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span>    <span style=color:#b6a0ff>return</span> location
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span><span style=color:#b6a0ff>function</span> find_location_phone_code(country) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span>    <span style=color:#b6a0ff>if</span> (country <span style=color:#00d3d0>==</span> <span style=color:#79a8ff>&#34;United States&#34;</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span><span>        country <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;usa&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span><span>    command <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;curl -s &#39;https://www.countrycode.org/&#34;</span> <span style=color:#b6a0ff>tolower</span>(country) <span style=color:#79a8ff>&#34;&#39; | htmlq &#39;h2.text-center&#39; -t&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span><span>    <span style=color:#b6a0ff>if</span> ((command <span style=color:#00d3d0>|</span> <span style=color:#b6a0ff>getline</span> phone_code) <span style=color:#00d3d0>==</span> <span style=color:#00bcff>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span><span>        phone_code <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span>    <span style=color:#b6a0ff>close</span>(command)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span><span>    <span style=color:#b6a0ff>return</span> phone_code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span><span>    <span style=color:#a8a8a8># Ignore the header line.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span><span>    <span style=color:#b6a0ff>if</span> (<span style=color:#f78fe7>NR</span> <span style=color:#00d3d0>==</span> <span style=color:#00bcff>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84</span><span>        next
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87</span><span>    origin <span style=color:#00d3d0>=</span> normalize_origin(<span style=color:#00d3d0>$</span><span style=color:#00bcff>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88</span><span>    status <span style=color:#00d3d0>=</span> get_website_status(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89</span><span>    title <span style=color:#00d3d0>=</span> fetch_website_title(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90</span><span>    content_type <span style=color:#00d3d0>=</span> fetch_website_content_type(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91</span><span>    ip <span style=color:#00d3d0>=</span> find_website_ip(origin)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92</span><span>    location <span style=color:#00d3d0>=</span> find_ip_location(ip)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93</span><span>    <span style=color:#b6a0ff>split</span>(location, location_parts, <span style=color:#79a8ff>&#34;,&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94</span><span>    phone_code <span style=color:#00d3d0>=</span> find_location_phone_code(location_parts[<span style=color:#00bcff>1</span>])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">95</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">96</span><span>    <span style=color:#b6a0ff>print</span> origin, <span style=color:#79a8ff>&#34;,&#34;</span>, status, <span style=color:#79a8ff>&#34;,&#34;</span>, title, <span style=color:#79a8ff>&#34;,&#34;</span>, content_type, <span style=color:#79a8ff>&#34;,&#34;</span>, ip, <span style=color:#79a8ff>&#34;,&#34;</span>, location, <span style=color:#79a8ff>&#34;,&#34;</span>, phone_code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">97</span><span>}
</span></span></code></pre></div></div><p>Finally, run the script and store the results in <em>output.csv</em>.
You can use <a href=https://github.com/wfxr/csview>csview</a> to present the CSV file.</p><div class="code mb-2"><div class=highlight><div style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./pipeline.awk input.csv &gt; output.csv
</span></span><span style=display:flex><span>$ csview -s ascii2 output.csv
</span></span><span style=display:flex><span>      Origin      | Status |                          Title                          | ContentType |       IP       |    Country    |  City   | PhoneCode
</span></span><span style=display:flex><span> -----------------+--------+---------------------------------------------------------+-------------+----------------+---------------+---------+-----------
</span></span><span style=display:flex><span>  https://gnu.org | OK     | The GNU Operating System and the Free Software Movement | text/html   | 209.51.188.116 | United States | Boston  | +1
</span></span><span style=display:flex><span>  https://0t1.me  | OK     | ZeroToOne - Home                                        | text/html   | 188.114.97.0   | Canada        | Toronto | +1
</span></span></code></pre></td></tr></table></div></div></div><h2 id=conclusion>Conclusion</h2><p>As weâ€™ve seen, AWK is a very handy and useful tool for working with data.
If you have a series of data processing tasks, you can use AWK to achieve the desired output.
For example, in one of my real cases, I needed to call multiple APIs to gather information, such as fetching user details and then retrieving user-registered processes, and etc.</p><p>I hope you find this article useful!</p></div><div></div><div><label class="badge p-0 article-tag fs-6 mx-1">#cli</label>
<label class="badge p-0 article-tag fs-6 mx-1">#awk</label>
<label class="badge p-0 article-tag fs-6 mx-1">#utilities</label></div><div class=mb-3></div><div class=giscus></div></div><script src=https://giscus.app/client.js data-repo=mortymacs/mortymacs data-repo-id=R_kgDOLJ_j-Q data-category=Q&A data-category-id=DIC_kwDOLJ_j-c4Ccuug data-mapping=url data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=dark data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></div></div><footer class="footer py-1 mt-auto"><div class=d-flex><div class="p-1 px-2 copyright-1">&copy;Morteza NourelahiAlamdari. All rights reserved.</div><div class="p-1 px-2 flex-fill text-end copyright-2"><a href=https://creativecommons.org/licenses/by-sa/4.0/ class="link-light link-underline-light" target=_blank><i class="fa-solid fa-scale-balanced"></i> CC BY-SA 4.0</a></div><div class="p-1 px-2 text-end git-status"><a href=https://github.com/mortymacs/mortymacs class="link-light link-underline-light" title=Git target=_blank><i class="fa-solid fa-code-branch"></i>origin/main</a></div><div class="p-1 px-2 text-end links"><a class="px-1 link-info" title=Github href=https://github.com/mortymacs target=_blank><i class="fa-brands fa-github"></i></a>
<a class="px-1 link-info" title=LinkedIn href=https://www.linkedin.com/in/mortymacs/ target=_blank><i class="fa-brands fa-linkedin"></i></a>
<a class="px-1 link-info" title=RSS href=https://0t1.me/rss.xml target=_blank><i class="fa-solid fa-square-rss"></i></a>
<a class="px-1 link-info" title=Sitemap href=https://0t1.me/sitemap.xml target=_blank><i class="fa-solid fa-sitemap"></i></a></div></div></footer></body></html>